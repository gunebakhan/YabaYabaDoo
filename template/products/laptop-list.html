{% extends 'products/products-list.html' %}
{% load static %}
{% block sidebar %}


<div class="mt-2 bg-white p-3 round">
    <div id="titleMain"> مرتب‌سازی بر اساس:</div>
    <form action="">
        <div class="form-check mr-3">
            <input class="form-check-input" type="radio" name="sorting" id="views" value="views">
            <label class="form-check-label" for="sorting">
                <span class="pr-3">پربازدیدترین</span>
            </label>
        </div>
        <div class="form-check mr-3">
            <input class="form-check-input" type="radio" name="sorting" id="sell" value="sell">
            <label class="form-check-label" for="sell">
                <span class="pr-3">پرفروش‌ترین</span>
            </label>
        </div>
        <div class="form-check  mr-3">
            <input class="form-check-input" type="radio" name="sorting" id="popular" value="popular">
            <label class="form-check-label" for="popular">
                <span class="pr-3">محبوب‌ترین</span>
            </label>
        </div>
        <div class="form-check mr-3">
            <input class="form-check-input" type="radio" name="sorting" id="new" value="new">
            <label class="form-check-label" for="new">
                <span class="pr-3">جدیدترین</span>
            </label>
        </div>
        <div class="form-check mr-3">
            <input class="form-check-input" type="radio" name="sorting" id="cheap" value="cheap">
            <label class="form-check-label" for="cheap">
                <span class="pr-3">ارزان‌ترین</span>
            </label>
        </div>
        <div class="form-check mr-3">
            <input class="form-check-input" type="radio" name="sorting" id="expensive" value="expensive">
            <label class="form-check-label" for="expensive">
                <span class="pr-3">گران‌ترین</span>
            </label>
        </div>
    </form>
</div>

<div class="mt-2 bg-white p-3 round">
    <div id="titleMain">جستجو در نتایج:</div>
    <form id="searchBrand">
        <span class="input-group-append">
            <!-- <button class="btn btn-outline-red border border-left-0" type="button"> -->
            <i class="fa fa-search" style="position: relative; right: 0.5rem; top: 2.2rem; z-index: 33333;"></i>
            <!-- </button> -->
        </span>
        <div class="input-group mt-2">
            <input type="text" class="form-control" style="padding-right:2rem;">
        </div>
    </form>
    <form action="">
        {% for brand in brands %}
        <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" value="brand_{{brand.name}}"" id=" {{brand.name}}"
                value="saeed">
            <label class="form-check-label mr-3 brand" for="{{brand.name}}">
                {{brand.name}}
            </label>
        </div>
        {% endfor %}
    </form>
</div>
<div class="mt-2 bg-white p-3 round">
    <div>
        صفحه نمایش لمسی </div>
    <hr>
    <form action="">
        {% for touchable in display_touchable %}
        <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" value="touch_{{touchable.0}}" id="{{touchable.0}}">
            <label class="form-check-label mr-3" for="{{touchable.0}}">
                {{touchable.0}}
            </label>
        </div>
        {% endfor %}
    </form>
</div>
<div class="mt-2 bg-white p-3 round">
    <div>
        صفحه نمایش مات </div>
    <hr>
    <form action="">
        {% for display_mate in display_mates %}
        <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" value="mate_{{display_mate.0}}"" id=" {{display_mate.0}}">
            <label class="form-check-label mr-3" for="{{display_mate.0}}">
                {{display_mate.0}}
            </label>
        </div>
        {% endfor %}
    </form>
</div>
<div class="mt-2 bg-white p-3 round">
    <div>
        سازنده پردازنده گرافیکی
    </div>
    <hr>
    <form action="" method="post">
        {% for gpu_manufacturer in gpu_manufacturers %}
        <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" value="gpu_{{gpu_manufacturer.0}}"
                id="{{gpu_manufacturer.0}}">
            <label class="form-check-label mr-3" for="{{gpu_manufacturer.0}}">
                {{gpu_manufacturer.0}}
            </label>
        </div>
        {% endfor %}
    </form>
</div>
<div class="mt-2 bg-white p-3 round">
    <div>نوع حافظه رم</div>
    <hr>
    <form>
        {% for ram_type in ram_types %}
        <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" value="ramType_{{ram_type.0}}" id="{{ram_type.0}}">
            <label class="form-check-label mr-3" for="{{ram_type.0}}">
                {{ram_type.0}}
            </label>
        </div>
        {% endfor %}
    </form>
</div>
<div class="mt-2 bg-white p-3 round" style="height: 20rem; overflow: auto; white-space: nowrap;">
    <div id="titleDisplay">دقت صفحه نمایش:</div>
    <form id="search‌‌‌Display">
        <span class="input-group-append">
            <!-- <button class="btn btn-outline-red border border-left-0" type="button"> -->
            <i class="fa fa-search" style="position: relative; right: 0.5rem; top: 2.2rem; z-index: 33333;"></i>
            <!-- </button> -->
        </span>
        <div class="input-group mt-2">
            <input type="text" class="form-control" style="padding-right:2rem;">
        </div>
    </form>
    <form>
        {% for display_accuracy in display_accuracies %}
        <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" value="resolution_{{display_accuracy.0}}"
                id="{{display_accuracy.0}}">
            <label class="form-check-label mr-3 display" for="{{display_accuracy.0}}">
                {{display_accuracy.0}}
            </label>
        </div>
        {% endfor %}
    </form>
</div>
<div class="mt-2 bg-white p-3 round" style="height: 20rem; overflow: auto; white-space: nowrap;">
    <div id="titleResolution">ظرفیت حافظه داخلی:</div>
    <form id="search‌‌Resolution">
        <span class="input-group-append">
            <!-- <button class="btn btn-outline-red border border-left-0" type="button"> -->
            <i class="fa fa-search" style="position: relative; right: 0.5rem; top: 2.2rem; z-index: 33333;"></i>
            <!-- </button> -->
        </span>
        <div class="input-group mt-2">
            <input type="text" class="form-control" style="padding-right:2rem;">
        </div>
    </form>
    <form action="">
        {% for storage in storages %}
        <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" value="storage_{{storage.0}}" id="{{storage.0}}">
            <label class="form-check-label mr-3 resolution" for="{{storage.0}}">
                {{storage.0}}
            </label>
        </div>
        {% endfor %}
    </form>
</div>
<div class="mt-2 bg-white p-3 round" style="height: 20rem; overflow: auto; white-space: nowrap;">
    <div id="titleStorage"> سری پردازنده:</div>
    <form id="searchStorage">
        <span class="input-group-append">
            <!-- <button class="btn btn-outline-red border border-left-0" type="button"> -->
            <i class="fa fa-search" style="position: relative; right: 0.5rem; top: 2.2rem; z-index: 33333;"></i>
            <!-- </button> -->
        </span>
        <div class="input-group mt-2">
            <input type="text" class="form-control" style="padding-right:2rem;">
        </div>
    </form>
    <form>
        {% for cpu_seri in cpu_series %}
        <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" value="cpu_{{cpu_seri.0}}" id="{{cpu_seri.0}}">
            <label class="form-check-label mr-3 storage" for="{{cpu_seri.0}}">
                {{cpu_seri.0}}
            </label>
        </div>
        {% endfor %}
    </form>
</div>
<div class="mt-2 bg-white p-3 round" style="height: 20rem; overflow: auto; white-space: nowrap;">
    <div id="titleStorage">ظرفیت حافظه RAM:</div>
    <form id="searchRAM">
        <span class="input-group-append">
            <!-- <button class="btn btn-outline-red border border-left-0" type="button"> -->
            <i class="fa fa-search" style="position: relative; right: 0.5rem; top: 2.2rem; z-index: 33333;"></i>
            <!-- </button> -->
        </span>
        <div class="input-group mt-2">
            <input type="text" class="form-control" style="padding-right:2rem;">
        </div>
    </form>

    <form>
        {% for ram in rams %}
        <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" value="ramCapacity_{{ram.0}}" name="ram" id="{{ram.0}}">
            <label class="form-check-label mr-3 ram" for="{{ram.0}}">
                {{ram.0}}
            </label>
        </div>{% endfor %}
    </form>
</div>
<div class="mt-2 bg-white p-3 round">
    <div class="slider-box">
        <label for="priceRange" id="sliderLabel">محدوده قیمت مورد نظر:</label>
        <input type="text" id="priceRange" readonly style="background-color: white; border: none;" dir="ltr">
        <div id="price-range" class="slider"></div>
    </div>
</div>
{% endblock sidebar %}


{% block script %}
<script src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"
    integrity="sha512-uto9mlQzrs59VwILcLiRYeLKPPbS/bT71da/OEBYEwcdNUk8jYIy+D176RYoop1Da+f9mvkYrmj5MCLZWEtQuA=="
    crossorigin="anonymous"></script>
<script src="{% static 'js/products_list.js' %}"></script>
<script>
    // Select all checkboxes with the name 'settings' using querySelectorAll.
    // var checkboxes = document.querySelectorAll("input[type=checkbox]");
    var checkboxes = document.querySelectorAll("input[class=form-check-input]");
    // console.log(radio);
    let enabledSettings = []

    /*
    For IE11 support, replace arrow functions with normal functions and
    use a polyfill for Array.forEach:
    https://vanillajstoolkit.com/polyfills/arrayforeach/
    */

    // Use Array.forEach to add an event listener to each checkbox.
    checkboxes.forEach(function (checkbox) {
        checkbox.addEventListener('change', function () {
            enabledSettings =
                Array.from(checkboxes) // Convert checkboxes to an array to use filter and map.
                    .filter(i => i.checked) // Use Array.filter to remove unchecked checkboxes.
                    .map(i => i.value) // Use Array.map to extract only the checkbox values from the array of objects.

            console.log(enabledSettings)
            $.ajax({
                type: "get",
                url: "{% url 'products:products_list' cat %}",
                data: {
                    data: enabledSettings,
                },
                dataType: 'JSON',
                success: function (response) {
                    $(".product_list").empty();
                    console.log(response['cat']);
                    var url_mask = " 'products:laptop_view' slug=12345".replace(/12345/, 'laptop');
                    var url_mask = "{% url 'products:laptop_view' cat=1234 slug=4567 %}".replace(/1234/, 'gf63-thin-9scxr');
                    url_mask = url_mask.replace(/6789/, 'laptop');
                    console.log(url_mask)
                    for (i = 0; i < response['product_ids'].length; i++) {
                        p_id = response['product_ids'][i];
                        var url_mask = "{% url 'products:laptop_view' cat=1234 slug=5678 %}".replace(/1234/, response['cat'].toString());
                        url_mask = url_mask.replace(/5678/, response['product_list'][p_id][2].toString());
                        $('.product_list').append(`<div class="col col-md-3">
                    <div class="card">
                        <a href="${url_mask}"><img class="card-img-top"
                                src="${response['product_list'][p_id][1]}" alt="Card image cap"></a>
                        <div class="card-body">
                            <h5 class="card-title" style="font-size: 0.85rem; color: rgba(0, 0, 0, 0.5);">
                                ${response['product_list'][p_id][0]}</h5>
                            <p class="card-text d-flex justify-content-between">
                                <span><i class="fa fa-check-circle" aria-hidden="true"
                                        style="color: seagreen;"></i><span class="mr-1"
                                        style="font-size: 0.7rem; color:rgba(0, 0, 0, 0.5)">موجود در انبار</span></span>
                                <span dir="ltr"><i class="fas fa-star" style="color: gold; font-size:0.7rem;"></i>${response['rating_dictionary'][p_id][0]} (${response['rating_dictionary'][p_id][1]})<span
                                        style="font-size:0.7rem;"></span></span>
                            </p>
                            <p style="font-size: 1rem; text-align: left;">${response['prices'][p_id]} تومان</p>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item shop" style="font-size: 0.85rem;">
                                    <i class="fas fa-shopping-cart" style="color: rgba(0, 0, 0, 0.4);"></i>
                                   ${response['shops'][p_id]} <i class="fas fa-smile" style="color: red;"></i>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>`);
                    }

                },

                error: function () { console.log('error in searching') }
            });
        })
    });



</script>
{% endblock script %}